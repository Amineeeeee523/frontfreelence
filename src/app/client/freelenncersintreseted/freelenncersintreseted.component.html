<div class="page-container">

  
  <!-- Main Content Layout -->
  <div class="main-layout">
    
         <!-- Left Column: Missions -->
     <div class="missions-column">
       <div class="missions-list-header">
         <h2 class="list-title">Vos missions</h2>
         <p class="list-subtitle">Sélectionnez une <span class="keyword-mission">mission</span> pour voir les <span class="keyword-freelancers">freelances intéressés</span></p>
       </div>

      <!-- Loading Missions State -->
      <div *ngIf="isLoadingMissions" class="loading-missions">
        <div class="spinner"></div>
        <p>Chargement de vos missions...</p>
      </div>

      <!-- Missions List -->
      <div class="missions-list" *ngIf="!isLoadingMissions && clientMissions.length > 0">
        <div *ngFor="let mission of clientMissions; trackBy: trackById" 
             class="mission-item"
             [class.active]="selectedMission?.id === mission.id"
             (click)="selectMission(mission)">
          
          <div class="mission-content">
            <div class="mission-icon">
              <fa-icon [icon]="faBriefcase"></fa-icon>
            </div>
            
                         <div class="mission-details">
               <h3 class="mission-title">{{ mission.titre }}</h3>
               <div class="mission-meta">
                 <span class="mission-category">{{ mission.categorie }}</span>
                 <span class="mission-budget">{{ mission.budget }} TND</span>
               </div>
             </div>

            <div class="mission-status">
              <div class="status-indicator" [class.active]="selectedMission?.id === mission.id">
                <fa-icon [icon]="faCheck" *ngIf="selectedMission?.id === mission.id"></fa-icon>
              </div>
            </div>
          </div>


        </div>
      </div>

      <!-- No Missions State -->
      <div *ngIf="!isLoadingMissions && clientMissions.length === 0" class="no-missions">
        <div class="icon-container">
          <fa-icon [icon]="faBriefcase" size="3x"></fa-icon>
        </div>
        <h2>Aucune mission active</h2>
        <p>Vous n'avez pas encore créé de missions. Créez votre première mission pour commencer !</p>
        <button class="create-mission-btn">
          <fa-icon [icon]="faPlus"></fa-icon>
          Créer une mission
        </button>
      </div>
    </div>

         <!-- Right Column: Freelancers -->
     <div class="freelancers-column">
       <div class="section-header">
                   <h2 class="section-title">
            Freelances intéressés
            <span class="freelance-count-badge" *ngIf="selectedMission && freelancers.length > 0">
              ({{ freelancers.length }})
            </span>
          </h2>
         <div class="section-subtitle" *ngIf="selectedMission">
            <span class="mission-context">Mission :</span>
            <span class="mission-name">{{ selectedMission.titre }}</span>
         </div>
         <p class="section-subtitle" *ngIf="!selectedMission">Sélectionnez une <span class="keyword-mission">mission</span> pour voir les <span class="keyword-freelancers">freelances intéressés</span></p>
       </div>

      <!-- Loading Freelancers State -->
      <div *ngIf="isLoadingFreelancers" class="loading-freelancers">
        <div class="spinner"></div>
        <p>Chargement des freelances...</p>
      </div>

      <!-- No Freelancers State -->
      <div *ngIf="!isLoadingFreelancers && selectedMission && freelancers.length === 0" class="no-freelancers">
        <div class="icon-container">
          <fa-icon [icon]="faUserTie" size="3x"></fa-icon>
        </div>
        <h2>Aucun freelance pour cette mission</h2>
        <p>Aucun freelance n'a encore manifesté son intérêt. Revenez plus tard !</p>
        <button (click)="reloadFreelancers()" class="retry-button">
          <fa-icon [icon]="faSync"></fa-icon> Recharger
        </button>
      </div>

      <!-- Freelancers Cards -->
      <div class="freelancers-grid" *ngIf="!isLoadingFreelancers && selectedMission && freelancers.length > 0">
        <div *ngFor="let freelancer of freelancers; trackBy: trackById" 
             class="freelancer-card"
             [class.liked]="freelancer.decision === 'like'"
             [class.disliked]="freelancer.decision === 'dislike'">
          
          <div class="top-bar">
            <div class="client-info">
              <img [src]="freelancer.photoUrl || freelancer.photoProfilUrl || 'https://i.pravatar.cc/50?u=' + freelancer.id" alt="Avatar freelance" class="client-avatar">
              <div class="client-details">
                <div class="client-name-row">
                  <span class="client-name">{{ freelancer.titreProfil || (freelancer.prenom + ' ' + freelancer.nom) }}</span>
                </div>
                <div class="client-badges">
                  <span class="badge gouv-badge" *ngIf="freelancer.gouvernorat || freelancer.localisation">
                    <fa-icon [icon]="faMapPin"></fa-icon>
                    {{ freelancer.gouvernorat || freelancer.localisation }}
                  </span>
                  <span class="badge match-score" *ngIf="freelancer.matchScore"><fa-icon [icon]="faStar"></fa-icon> {{ (freelancer.matchScore || 0) * 100 | number:'1.0-0' }}% Match</span>
                </div>
              </div>
            </div>
            <div class="top-chips">
              <span class="urgent-badge" *ngIf="freelancer.badgePrincipal">
                <fa-icon [icon]="faCheckCircle"></fa-icon>
                {{ freelancer.badgePrincipal }}
              </span>
              <a *ngIf="freelancer.linkedinUrl"
                 class="social-button linkedin"
                 [href]="freelancer.linkedinUrl"
                 target="_blank" rel="noopener noreferrer"
                 title="Voir le profil LinkedIn"
                 (click)="$event.stopPropagation()"
                 (pointerdown)="$event.stopPropagation()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                  <path fill="currentColor" d="M20.447 20.452H17.21v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.447-2.136 2.943v5.663H9.005V9h3.111v1.561h.045c.434-.82 1.494-1.686 3.073-1.686 3.29 0 3.897 2.165 3.897 4.985v6.592zM5.337 7.433a1.804 1.804 0 1 1 0-3.608 1.804 1.804 0 0 1 0 3.608zM6.78 20.452H3.893V9H6.78v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.226.792 24 1.771 24h20.451C23.2 24 24 23.226 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
              </a>
              <a *ngIf="freelancer.githubUrl"
                 class="social-button github"
                 [href]="freelancer.githubUrl"
                 target="_blank" rel="noopener noreferrer"
                 title="Voir le GitHub"
                 (click)="$event.stopPropagation()"
                 (pointerdown)="$event.stopPropagation()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                  <path fill="currentColor" d="M12 .5C5.73.5.77 5.46.77 11.74c0 4.93 3.19 9.11 7.62 10.59.56.1.77-.24.77-.54 0-.27-.01-1.16-.02-2.1-3.1.67-3.76-1.32-3.76-1.32-.51-1.29-1.25-1.63-1.25-1.63-1.02-.7.08-.68.08-.68 1.13.08 1.72 1.16 1.72 1.16 1 .1.68-.77 1.86-1.2.1-.73.39-1.22.72-1.5-2.48-.28-5.1-1.24-5.1-5.54 0-1.22.44-2.22 1.16-3-.12-.29-.5-1.46.11-3.04 0 0 .94-.3 3.08 1.15a10.7 10.7 0 0 1 2.8-.38c.95 0 1.9.13 2.8.38 2.14-1.45 3.08-1.15 3.08-1.15.61 1.58.24 2.75.12 3.04.72.78 1.16 1.78 1.16 3 0 4.31-2.62 5.26-5.11 5.54.4.35.76 1.03.76 2.07 0 1.49-.01 2.69-.01 3.06 0 .3.21.65.78.54 4.42-1.49 7.61-5.66 7.61-10.59C23.23 5.46 18.27.5 12 .5z"/>
                </svg>
              </a>
            </div>
          </div>

          <div class="title-row">
            <h3 class="mission-title">{{ freelancer.titreProfil || (freelancer.prenom + ' ' + freelancer.nom) }}</h3>
          </div>

          <div class="mission-meta">
            <div class="meta-item budget" *ngIf="freelancer.tarifJournalier != null; else hourly"><fa-icon [icon]="faDollarSign"></fa-icon> {{ freelancer.tarifJournalier }} TND/j</div>
            <ng-template #hourly>
              <div class="meta-item budget" *ngIf="freelancer.tarifHoraire != null"><fa-icon [icon]="faDollarSign"></fa-icon> {{ freelancer.tarifHoraire }} TND/h</div>
            </ng-template>
            <div class="meta-item duration" *ngIf="freelancer.chargeHebdoSouhaiteeJours"><fa-icon [icon]="faLevelUpAlt"></fa-icon> {{ freelancer.chargeHebdoSouhaiteeJours }} j/sem</div>
            <div class="meta-item modality" *ngIf="freelancer.mobilite"><fa-icon [icon]="faBriefcase"></fa-icon> {{ freelancer.mobilite }}</div>
            <div class="meta-item category" *ngIf="freelancer.niveauExperience"><fa-icon [icon]="faStar"></fa-icon> {{ freelancer.niveauExperience | titlecase }}</div>
            <div class="meta-item experience" *ngIf="freelancer.anneesExperience != null"><fa-icon [icon]="faCheckCircle"></fa-icon> {{ freelancer.anneesExperience }} ans</div>
            <div class="meta-item workload" *ngIf="freelancer.disponibilite"><fa-icon [icon]="faHandshake"></fa-icon> {{ freelancer.disponibilite }}</div>
            <div class="meta-item deadline" *ngIf="freelancer.dateDisponibilite"><fa-icon [icon]="faCalendarDay"></fa-icon> Disponible: {{ freelancer.dateDisponibilite | date:'dd/MM' }}</div>
          </div>

          <div class="media-preview" *ngIf="freelancer.portfolioUrls && freelancer.portfolioUrls.length">
            <img [src]="freelancer.portfolioUrls[0]" alt="Aperçu portfolio" />
            <div class="media-count" *ngIf="freelancer.portfolioUrls.length > 1">+{{ freelancer.portfolioUrls.length - 1 }}</div>
          </div>

          <div class="mission-skills" *ngIf="freelancer.competences && freelancer.competences.length">
            <span class="kpi-badge" *ngFor="let skill of freelancer.competences | slice:0:6">
              <span class="kpi-dot"></span>
              <span class="kpi-label">{{ skill }}</span>
            </span>
          </div>

          <!-- Action Buttons -->
          <div class="card-actions">
            <button class="action-button dislike" (click)="onDislike(freelancer)" [disabled]="animating">
              <fa-icon [icon]="faTimes"></fa-icon>
            </button>
            <button class="action-button like" (click)="onLike(freelancer)" [disabled]="animating">
              <fa-icon [icon]="faHeart"></fa-icon>
            </button>
          </div>

          <!-- Decision Overlay -->
          <div class="decision-overlay" *ngIf="freelancer.decision">
            <div class="overlay-content" [class.like]="freelancer.decision === 'like'" [class.dislike]="freelancer.decision === 'dislike'">
              <fa-icon [icon]="freelancer.decision === 'like' ? faHeart : faTimes"></fa-icon>
              <span>{{ freelancer.decision === 'like' ? 'ACCEPTÉ' : 'REFUSÉ' }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Initial state : No mission selected -->
      <div *ngIf="!selectedMission && !isLoadingMissions" class="initial-prompt">
        <fa-icon [icon]="faBriefcase" size="4x" class="prompt-icon"></fa-icon>
        <h2>Bienvenue !</h2>
        <p>Pour commencer, veuillez sélectionner l'une de vos missions dans la liste ci-contre.</p>
      </div>
    </div>

  </div>
</div>
